{"version":3,"file":"cucumber-to-junit.cjs.development.js","sources":["../src/index.ts"],"sourcesContent":["import jsonFile from 'jsonfile';\nimport builder from \"junit-report-builder\";\nimport { Feature, Scenario, StepStatus } from \"./model/cucumber\";\nimport { Config } from \"./model/config\";\n\nexport class CucumberConverter {\n  constructor(private config: Config) {}\n\n  public convertToJunit(inputFilePath: string, outputFilePath: string): void {\n    const cucumberReport: Feature[] = jsonFile.readFileSync(inputFilePath);\n\n    for (const feature of cucumberReport) {\n      this.addTestSuite(feature);\n    }\n\n    builder.writeTo(outputFilePath);\n  }\n\n  private addTestSuite(feature: Feature): void {\n    let suiteDuration = 0;\n    const suite = builder.testSuite().name(feature.name);\n\n    for (const scenario of feature.elements) {\n      suiteDuration += this.addTestCases(scenario, suite);\n    }\n\n    suite.time(suiteDuration);\n  }\n\n  private addTestCases(scenario: Scenario, suite: any): number {\n    if (scenario.type === 'background') {\n      return 0;\n    }\n\n    const scenarioResult = this.getScenarioResult(scenario);\n\n    const testCase = suite.testCase()\n      .name(scenario.name)\n      .className(scenario.id)\n      .time(scenarioResult.duration);\n\n    if (scenarioResult.status === 'failed') {\n        testCase.failure(scenarioResult.failureMessage);\n    } else if (scenarioResult.status === 'skipped' || scenarioResult.status === 'undefined') {\n      testCase.skipped();\n    }\n\n    return scenarioResult.duration;\n  }\n\n  private getScenarioResult(scenario: Scenario) {\n    let scenarioStatus: StepStatus = 'passed';\n    let failureMessage = '';\n    let scenarioDuration = 0;\n\n    for (const step of scenario.steps) {\n      scenarioDuration += (step.result.duration ? step.result.duration / 1000000000 : 0); //ns to seconds;\n\n      if(scenarioStatus === 'failed') {\n        continue;\n      }\n\n      if (step.result.status === 'failed') {\n        scenarioStatus = 'failed';\n        failureMessage = step.result.error_message!;\n      }\n      else if (this.config.markUndefinedAsFailed && step.result.status === 'undefined') {\n        scenarioStatus = 'failed';\n        failureMessage = 'One or more steps are undefined';\n      } else {\n        scenarioStatus = step.result.status;\n      }\n    }\n\n    return {\n      status: scenarioStatus,\n      failureMessage: failureMessage,\n      duration: scenarioDuration\n    };\n  }\n}\n"],"names":["CucumberConverter","config","convertToJunit","inputFilePath","outputFilePath","cucumberReport","jsonFile","readFileSync","feature","addTestSuite","builder","writeTo","suiteDuration","suite","testSuite","name","elements","scenario","addTestCases","time","type","scenarioResult","getScenarioResult","testCase","className","id","duration","status","failure","failureMessage","skipped","scenarioStatus","scenarioDuration","steps","step","result","error_message","markUndefinedAsFailed"],"mappings":"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"}